{% extends 'base.html' %}

{% block content %}

    <section class="mb-6">
        <h2 class="text-2xl font-semibold mb-3">Explore Countries</h2>
        <input
            type="text"
            id="search"
            placeholder="Search by country name..."
            class="w-full max-w-md p-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
    </section>

    <section class="grid md:grid-cols-2 gap-6">
        <ul id="country-list" class="space-y-2"></ul>
        <div id="country-details" class="bg-white p-6 rounded-lg shadow"></div>
    </section>

    <script>
    async function fetchCountries(query="") {
        let url = "/countries";
        if (query) url += "?name=" + encodeURIComponent(query);
        const res = await fetch(url);
        return await res.json();
    }

    async function showCountries() {
        const countries = await fetchCountries();
        const list = document.getElementById("country-list");
        list.innerHTML = "";
        countries.forEach(c => {
            const li = document.createElement("li");
            li.textContent = c['@name'];
            li.className = "bg-white p-3 rounded-md shadow cursor-pointer hover:bg-blue-100 transition";
            li.onclick = () => showCountryDetails(c['@name']);
            list.appendChild(li);
        });
    }

    async function showCountryDetails(name) {
        const res = await fetch(`/countries/${encodeURIComponent(name)}`);
        if (!res.ok) return;
        const c = await res.json();
        const details = document.getElementById("country-details");
        details.innerHTML = `
            <h3 class="text-xl font-bold mb-4">${c['@name']}</h3>
            <ul class="space-y-2 text-gray-700">
                <li><strong>Capital:</strong> ${c.capital}</li>
                <li><strong>Population:</strong> ${c.population}</li>
                <li><strong>Language:</strong> ${c.language}</li>
                <li><strong>Currency:</strong> ${c.currency}</li>
                <li><strong>Timezone:</strong> ${c.timezone}</li>
            </ul>
        `;
    }

    document.getElementById("search").addEventListener("input", async function() {
        const query = this.value.toLowerCase();
        const countries = await fetch("/countries").then(r => r.json());
        const filtered = countries.filter(c => c['@name'].toLowerCase().includes(query));
        const list = document.getElementById("country-list");
        list.innerHTML = "";
        filtered.forEach(c => {
            const li = document.createElement("li");
            li.textContent = c['@name'];
            li.className = "bg-white p-3 rounded-md shadow cursor-pointer hover:bg-blue-100 transition";
            li.onclick = () => showCountryDetails(c['@name']);
            list.appendChild(li);
        });
        document.getElementById("country-details").innerHTML = "";
    });

    showCountries();
    </script>
{% endblock %}
