{% extends 'base.html' %}

{% block content %}
    <h1>{% block title %} Welcome to your Flask app! {% endblock %}</h1>
    <h2>Explore Countries</h2>
    <input type="text" id="search" placeholder="Search by country name..." style="width: 250px; padding: 5px;">
    <ul id="country-list"></ul>
    <div id="country-details"></div>
    <script>
    async function fetchCountries(query="") {
        let url = "/countries";
        if (query) url += "?name=" + encodeURIComponent(query);
        const res = await fetch(url);
        return await res.json();
    }

    async function showCountries() {
        const countries = await fetchCountries();
        const list = document.getElementById("country-list");
        list.innerHTML = "";
        countries.forEach(c => {
            const li = document.createElement("li");
            li.textContent = c['@name'];
            li.style.cursor = "pointer";
            li.onclick = () => showCountryDetails(c['@name']);
            list.appendChild(li);
        });
    }

    async function showCountryDetails(name) {
        const res = await fetch(`/countries/${encodeURIComponent(name)}`);
        if (!res.ok) return;
        const c = await res.json();
        const details = document.getElementById("country-details");
        details.innerHTML = `
            <h3>${c['@name']}</h3>
            <ul>
                <li><b>Capital:</b> ${c.capital}</li>
                <li><b>Population:</b> ${c.population}</li>
                <li><b>Language:</b> ${c.language}</li>
                <li><b>Currency:</b> ${c.currency}</li>
                <li><b>Timezone:</b> ${c.timezone}</li>
            </ul>
        `;
    }

    document.getElementById("search").addEventListener("input", async function() {
        const query = this.value.toLowerCase();
        const countries = await fetch("/countries").then(r => r.json());
        const filtered = countries.filter(c => c['@name'].toLowerCase().includes(query));
        const list = document.getElementById("country-list");
        list.innerHTML = "";
        filtered.forEach(c => {
            const li = document.createElement("li");
            li.textContent = c['@name'];
            li.style.cursor = "pointer";
            li.onclick = () => showCountryDetails(c['@name']);
            list.appendChild(li);
        });
        document.getElementById("country-details").innerHTML = "";
    });

    showCountries();
    </script>
{% endblock %}
